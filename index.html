<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å¹¸è¿è½¬ç›˜ ğŸ’–</title>

<style>
  :root{
    --wheelSize: 380px;
    --ring: 12px;
    --glass: rgba(255,255,255,.16);
    --glass2: rgba(255,255,255,.22);
    --hot:#ff3d9a;
    --pink:#fb7185;
  }
  *{ box-sizing:border-box; }
  body{
    margin:0; overflow:hidden;
    font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",system-ui,Arial,sans-serif;
    color:#fff; text-align:center;
    background:
      radial-gradient(900px 650px at 20% 20%, rgba(96,165,250,.35), transparent 60%),
      radial-gradient(900px 650px at 80% 25%, rgba(34,197,94,.25), transparent 60%),
      radial-gradient(900px 650px at 60% 80%, rgba(251,113,133,.34), transparent 60%),
      linear-gradient(135deg,#ff9a9e,#fad0c4);
  }

  .blob{ position:fixed; pointer-events:none; width:520px;height:520px;border-radius:50%;
    filter: blur(44px); opacity:.42; animation: drift 14s ease-in-out infinite; }
  .b1{ left:-140px; top:-170px; background: radial-gradient(circle at 30% 30%, rgba(96,165,250,.95), transparent 60%); }
  .b2{ right:-170px; top:40px; background: radial-gradient(circle at 30% 30%, rgba(34,197,94,.85), transparent 60%); animation-duration:16s;}
  .b3{ left:110px; bottom:-220px; background: radial-gradient(circle at 30% 30%, rgba(251,113,133,.9), transparent 60%); animation-duration:18s;}
  @keyframes drift{ 0%,100%{ transform: translate(0,0) scale(1); } 50%{ transform: translate(70px, 40px) scale(1.06); } }

  .spark{
    position:fixed; inset:0; pointer-events:none;
    background:
      radial-gradient(2px 2px at 12% 18%, rgba(255,255,255,.65), transparent 50%),
      radial-gradient(2px 2px at 72% 22%, rgba(255,255,255,.55), transparent 50%),
      radial-gradient(2px 2px at 38% 66%, rgba(255,255,255,.55), transparent 50%),
      radial-gradient(2px 2px at 88% 72%, rgba(255,255,255,.6), transparent 50%),
      radial-gradient(2px 2px at 22% 82%, rgba(255,255,255,.55), transparent 50%);
    opacity:.75; animation: twinkle 2.2s ease-in-out infinite alternate;
  }
  @keyframes twinkle{ from{opacity:.5;} to{opacity:.95;} }

  h1{ margin:22px 12px 8px; font-size:26px; letter-spacing:.6px;
    text-shadow:0 14px 40px rgba(0,0,0,.25); }
  .sub{ margin:0 16px 14px; font-size:14px; line-height:1.7;
    color:rgba(255,255,255,.9); text-shadow:0 10px 28px rgba(0,0,0,.14); }

  .marquee{
    width:min(640px,92vw); margin:10px auto 0; padding:10px 12px;
    border-radius:16px; background: rgba(255,255,255,.18);
    border:1px solid rgba(255,255,255,.22); backdrop-filter: blur(10px);
    overflow:hidden; box-shadow:0 16px 44px rgba(0,0,0,.12);
  }
  .marquee span{ display:inline-block; white-space:nowrap; animation: scroll 12s linear infinite;
    font-weight:1000; letter-spacing:.3px; }
  @keyframes scroll{ from{ transform: translateX(100%);} to{ transform: translateX(-100%);} }

  .card{
    width:min(720px, 92vw);
    margin:0 auto;
    border-radius:22px;
    border:1px solid rgba(255,255,255,.28);
    background: rgba(255,255,255,.14);
    backdrop-filter: blur(12px);
    box-shadow: 0 28px 90px rgba(0,0,0,.18);
    padding:18px 14px 16px;
  }
  .wrap{ display:flex; flex-direction:column; align-items:center; gap:14px; padding-top:6px; }

  .pointer{
    position:relative; width:0;height:0;
    border-left:16px solid transparent; border-right:16px solid transparent;
    border-bottom:36px solid rgba(255,255,255,.96);
    filter: drop-shadow(0 10px 14px rgba(0,0,0,.28));
    z-index:15; margin-top:2px;
  }
  .pointer::after{
    content:""; position:absolute; left:-8px; top:31px;
    width:16px;height:16px; background:rgba(255,255,255,.96);
    border-radius:999px; box-shadow: 0 10px 24px rgba(0,0,0,.18);
  }

  .wheelShell{
    width: var(--wheelSize); height: var(--wheelSize);
    border-radius:50%;
    border: var(--ring) solid rgba(255,255,255,.95);
    position:relative;
    overflow:hidden;
    box-shadow:
      0 24px 85px rgba(0,0,0,.26),
      0 0 0 6px rgba(255,255,255,.18),
      0 0 50px rgba(255,255,255,.6);
    background: rgba(255,255,255,.08);
    backdrop-filter: blur(12px);
  }
  .wheelShell::after{
    content:""; position:absolute; inset:-10px; border-radius:50%;
    border:2px solid rgba(255,255,255,.35);
    box-shadow: 0 0 30px rgba(255,61,154,.35);
    animation: neon 1.6s ease-in-out infinite alternate;
    pointer-events:none;
  }
  @keyframes neon{ from{ filter: brightness(1); opacity:.7; } to{ filter: brightness(1.25); opacity:1; } }

  #wheel{
    position:absolute; inset:0;
    border-radius:50%;
    transition: transform 4.8s cubic-bezier(.2,1,.25,1);
    will-change: transform;
  }

  .hub{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%);
    width:92px; height:92px;
    border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,255,255,.75));
    box-shadow: 0 18px 44px rgba(0,0,0,.25);
    display:grid; place-items:center;
    z-index:30;
    user-select:none;
  }
  #loveBtn{
    width:78px; height:78px;
    border-radius:50%;
    border:none;
    background: radial-gradient(circle at 30% 30%, rgba(255,61,154,.92), rgba(251,113,133,.78));
    color:#fff; font-weight:1000; letter-spacing:.8px;
    box-shadow: 0 0 24px rgba(255,61,154,.55);
    animation: pulse 1.4s ease-in-out infinite;
    cursor:pointer;
    touch-action: manipulation;
  }
  #loveBtn:active{ transform: scale(.98); }
  @keyframes pulse{
    0%,100%{ transform: scale(1); filter: brightness(1); }
    50%{ transform: scale(1.06); filter: brightness(1.08); }
  }

  #result{
    margin-top:4px;
    width:min(620px, 92vw);
    padding:14px 14px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.28);
    background: rgba(255,255,255,.22);
    backdrop-filter: blur(10px);
    box-shadow: 0 18px 44px rgba(0,0,0,.12);
    font-size:15px;
    line-height:1.75;
  }
  .winTitle{ font-size:18px; font-weight:1000; margin-bottom:4px; }
  .shake{ animation: shake .22s ease-in-out 2; }
  @keyframes shake{ 0%,100%{ transform: translateX(0); } 25%{ transform: translateX(-3px); } 75%{ transform: translateX(3px); } }

  .btn{
    border:none; cursor:pointer;
    border-radius:999px;
    padding:12px 22px;
    font-size:16px;
    font-weight:1000;
    background: rgba(255,255,255,.92);
    color: #111827;
    box-shadow: 0 16px 34px rgba(0,0,0,.18);
  }
  .btn:active{ transform: translateY(1px) scale(.99); }

  #popup{
    display:none;
    position:fixed; inset:0;
    background: rgba(0,0,0,.78);
    justify-content:center; align-items:center;
    padding:18px;
    z-index:99;
  }
  .popupBox{
    width:min(420px, 92vw);
    border-radius:22px;
    border:1px solid rgba(255,255,255,.25);
    background: rgba(255,255,255,.92);
    color: var(--hot);
    box-shadow: 0 30px 120px rgba(0,0,0,.35);
    padding:22px 18px 18px;
    position:relative;
    overflow:hidden;
  }
  .popupBox::before{
    content:""; position:absolute; inset:-40px;
    background:
      radial-gradient(circle at 20% 30%, rgba(255,61,154,.28), transparent 60%),
      radial-gradient(circle at 80% 20%, rgba(96,165,250,.25), transparent 60%),
      radial-gradient(circle at 60% 90%, rgba(34,197,94,.18), transparent 60%);
    filter: blur(12px); opacity:.9; pointer-events:none;
  }
  .popupInner{ position:relative; z-index:2; }
  .popupBox h2{ margin:4px 0 10px; font-size:18px; font-weight:1000; }
  .popupHint{ margin:0 0 14px; color:#7c3aed; font-weight:900; font-size:13px; }

  .chooseArea{
    position:relative;
    height:150px;
    border-radius:16px;
    background: rgba(255,255,255,.58);
    border:1px dashed rgba(255,61,154,.35);
    overflow:hidden;
  }
  .yesBtn, .noBtn{
    position:absolute;
    border-radius:999px;
    padding:12px 18px;
    font-size:15px;
    font-weight:1000;
    border:none;
    cursor:pointer;
    box-shadow: 0 16px 34px rgba(0,0,0,.12);
    user-select:none;
  }
  .yesBtn{ left:18px; top:58px; background: linear-gradient(90deg, var(--hot), var(--pink)); color:#fff; }
  .noBtn{ left:230px; top:60px; background: rgba(17,24,39,.10); color:#111827;
    transition: left .16s ease, top .16s ease, transform .16s ease; }
  .closeX{
    position:absolute; right:10px; top:8px;
    width:34px; height:34px;
    border-radius:999px;
    border:none; cursor:pointer;
    background: rgba(0,0,0,.08);
    color:#111827;
    font-weight:1000;
    z-index:5;
  }

  .heart{
    position:fixed; top:-12px; font-size:20px;
    animation: fall 6s linear infinite;
    pointer-events:none; z-index:70;
    filter: drop-shadow(0 10px 10px rgba(0,0,0,.2));
  }
  @keyframes fall{ to{ transform: translateY(110vh); opacity:0; } }

  canvas{ position:fixed; inset:0; pointer-events:none; z-index:80; }

  @media (max-width:390px){ :root{ --wheelSize: 330px; } }
</style>
</head>

<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
  <div class="spark"></div>
  <canvas id="fx"></canvas>

  <h1>å¹¸è¿è½¬ç›˜ ğŸ’–</h1>
  <div class="sub">ç‚¹ä¸­é—´ <b>LOVE</b> å¼€å§‹æŠ½å¥–ï½</div>

  <div class="marquee">
    <span>âœ¨ å¥½è¿åŠ è½½ä¸­â€¦ã€€ğŸ’ å¿ƒåŠ¨å€¼ä¸Šå‡ä¸­â€¦ã€€ğŸ ç¤¼ç‰©æ­£åœ¨è·¯ä¸Šâ€¦ã€€ğŸŒ¹ ä½ å…ˆç‚¹ LOVEï½</span>
  </div>

  <div class="card">
    <div class="wrap">
      <div class="pointer" aria-hidden="true"></div>

      <div class="wheelShell">
        <div id="wheel"></div>

        <div class="hub">
          <button id="loveBtn" type="button" aria-label="LOVE">LOVE</button>
        </div>
      </div>

      <div id="result">å‡†å¤‡å¥½äº†å—ï¼Ÿç‚¹ LOVE å¼€å§‹ã€‚</div>
    </div>
  </div>

  <!-- BGMï¼šæ— å¼€å…³ -->
  <audio id="bgm" loop autoplay playsinline>
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5a6fa2e1f3.mp3?filename=romantic-background-112199.mp3" type="audio/mp3">
  </audio>

  <div id="popup">
    <div class="popupBox">
      <button class="closeX" id="closeX">Ã—</button>
      <div class="popupInner" id="popupInner"></div>
    </div>
  </div>

<script>
  const wheelEl = document.getElementById("wheel");
  const loveBtn = document.getElementById("loveBtn");
  const result = document.getElementById("result");

  const popup = document.getElementById("popup");
  const closeX = document.getElementById("closeX");
  const popupInner = document.getElementById("popupInner");

  const bgm = document.getElementById("bgm");

  // ====== é…ç½® ======
  const prizes = ["æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","ğŸ“¸ æ‹ç«‹å¾—","ğŸ¶ çº¿æ¡å°ç‹—","ğŸŒ¹ é²œèŠ±","ğŸ’– è·å¾—æ‰€æœ‰ç¤¼å“"];
  const N = prizes.length;
  const STEP = 360 / N;

  // âœ… æ°¸è¿œé”å®šâ€œè·å¾—æ‰€æœ‰ç¤¼å“â€è¿™ä¸ªæ‰‡åŒºï¼ˆé˜²æ­¢ä½ ä»¥åæ”¹é¡ºåºï¼‰
  const WIN_INDEX = prizes.indexOf("ğŸ’– è·å¾—æ‰€æœ‰ç¤¼å“");

  // âœ… å›ºå®šå¾®è°ƒï¼šåå·¦ç”¨æ­£æ•°ï¼Œåå³ç”¨è´Ÿæ•°ï¼ˆä¸€èˆ¬ 0.4~1.6ï¼‰
  const CORRECTION_DEG = 0.9;

  // ====== ç”Ÿæˆ SVG è½®ç›˜ï¼ˆé¢œè‰²+ç™½çº¿+æ–‡å­—ç»å¯¹å¯¹é½ï¼‰=====
  const size = 1000;
  const cx = size/2, cy = size/2;
  const rOuter = 470;

  const colors = [
    "#d1d5db","#e5e7eb","#d1d5db","#e5e7eb","#d1d5db","#e5e7eb",
    "rgba(255,159,243,0.95)",
    "rgba(254,202,87,0.95)",
    "rgba(72,219,251,0.95)",
    "rgba(255,107,107,0.95)"
  ];

  function polarToXY(r, deg){
    const rad = (deg-90) * Math.PI/180;
    return { x: cx + r*Math.cos(rad), y: cy + r*Math.sin(rad) };
  }
  function wedgePath(startDeg, endDeg){
    const p1 = polarToXY(rOuter, startDeg);
    const p2 = polarToXY(rOuter, endDeg);
    const large = (endDeg - startDeg) > 180 ? 1 : 0;
    return [
      `M ${cx} ${cy}`,
      `L ${p1.x} ${p1.y}`,
      `A ${rOuter} ${rOuter} 0 ${large} 1 ${p2.x} ${p2.y}`,
      `Z`
    ].join(" ");
  }

  const svgNS = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(svgNS,"svg");
  svg.setAttribute("viewBox", `0 0 ${size} ${size}`);
  svg.setAttribute("width","100%");
  svg.setAttribute("height","100%");
  svg.style.borderRadius = "50%";

  const g = document.createElementNS(svgNS,"g");

  // æ‰‡åŒº
  for(let i=0;i<N;i++){
    const start = i*STEP;
    const end = (i+1)*STEP;
    const path = document.createElementNS(svgNS,"path");
    path.setAttribute("d", wedgePath(start, end));
    path.setAttribute("fill", colors[i] || "#e5e7eb");
    g.appendChild(path);
  }

  // ç™½è‰²åˆ†å‰²çº¿ï¼ˆçœŸçº¿ï¼‰
  for(let i=0;i<N;i++){
    const deg = i*STEP;
    const p = polarToXY(rOuter, deg);
    const line = document.createElementNS(svgNS,"line");
    line.setAttribute("x1", cx);
    line.setAttribute("y1", cy);
    line.setAttribute("x2", p.x);
    line.setAttribute("y2", p.y);
    line.setAttribute("stroke", "rgba(255,255,255,.95)");
    line.setAttribute("stroke-width", "12");
    line.setAttribute("stroke-linecap", "round");
    g.appendChild(line);
  }

  // å†…åœˆæ·¡å…‰
  const inner = document.createElementNS(svgNS,"circle");
  inner.setAttribute("cx", cx);
  inner.setAttribute("cy", cy);
  inner.setAttribute("r", 430);
  inner.setAttribute("fill","none");
  inner.setAttribute("stroke","rgba(255,255,255,.25)");
  inner.setAttribute("stroke-width","10");
  g.appendChild(inner);

  // æ–‡å­—ï¼ˆæ¯ä¸ªæ‰‡åŒºä¸­å¿ƒçº¿æ–¹å‘ï¼‰
  for(let i=0;i<N;i++){
    const mid = i*STEP + STEP/2;
    const pos = polarToXY(280, mid);
    const t = document.createElementNS(svgNS,"text");
    t.setAttribute("x", pos.x);
    t.setAttribute("y", pos.y);
    t.setAttribute("text-anchor","middle");
    t.setAttribute("dominant-baseline","middle");
    t.setAttribute("font-size", prizes[i].length>=6 ? "34" : "36");
    t.setAttribute("font-weight","900");
    t.setAttribute("fill", prizes[i]==="æ²¡ä¸­å¥–" ? "#6b7280" : "#111827");
    t.setAttribute("style","filter: drop-shadow(0 6px 10px rgba(0,0,0,.18)); user-select:none;");
    t.setAttribute("transform", `rotate(${mid} ${pos.x} ${pos.y})`);
    t.textContent = prizes[i];
    g.appendChild(t);
  }

  // ä¸­å¿ƒç›–å¸½
  const cap = document.createElementNS(svgNS,"circle");
  cap.setAttribute("cx", cx);
  cap.setAttribute("cy", cy);
  cap.setAttribute("r", 130);
  cap.setAttribute("fill","rgba(255,255,255,.65)");
  cap.setAttribute("stroke","rgba(255,255,255,.55)");
  cap.setAttribute("stroke-width","8");
  g.appendChild(cap);

  svg.appendChild(g);
  wheelEl.appendChild(svg);

  // ====== æ—‹è½¬é€»è¾‘ï¼ˆâœ…æ°¸è¿œä¸ä¼šâ€œè½¬å‡ æ¬¡è·‘åˆ°é²œèŠ±â€ï¼‰=====
  let spinning = false;
  let currentRotation = 0;

  // âœ… åªè¿”å›â€œå¯¹é½è§’â€ï¼Œä¸è¦åŠ åœˆæ•°ï¼Œåœˆæ•°åœ¨ startSpin é‡Œç»Ÿä¸€æ§åˆ¶
  function alignAngleToIndex(index){
    const winCenter = index*STEP + STEP/2; // æ‰‡åŒºä¸­å¿ƒè§’
    return -winCenter;                     // æŠŠè¯¥ä¸­å¿ƒè§’è½¬åˆ°é¡¶éƒ¨æŒ‡é’ˆ
  }

  // ====== BGM è‡ªåŠ¨æ’­æ”¾ï¼ˆè‹¥è¢«æ‹¦æˆªï¼Œç‚¹ LOVE è§£é”ï¼‰=====
  let audioUnlocked = false;
  async function tryAutoplay(){ try{ await bgm.play(); }catch(e){} }
  document.addEventListener("DOMContentLoaded", tryAutoplay);
  async function unlockAudio(){
    if(audioUnlocked) return;
    audioUnlocked = true;
    try{ await bgm.play(); }catch(e){}
  }

  // ====== å½©å¸¦ ======
  const canvas = document.getElementById("fx");
  const ctx = canvas.getContext("2d");
  let W=0,H=0,parts=[],raf=null;
  function resize(){ W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
  addEventListener("resize", resize); resize();

  function confettiBurst(){
    parts = [];
    for(let i=0;i<220;i++){
      parts.push({
        x: Math.random()*W, y: -30 - Math.random()*H*0.15,
        vx: -3 + Math.random()*6, vy: 3 + Math.random()*9,
        r: 3 + Math.random()*7,
        rot: Math.random()*Math.PI,
        vr: -0.25 + Math.random()*0.5,
        life: 150 + Math.random()*80
      });
    }
    if(raf) cancelAnimationFrame(raf);
    tick();
  }
  function tick(){
    ctx.clearRect(0,0,W,H);
    for(const p of parts){
      p.x += p.vx; p.y += p.vy; p.vy *= 1.01; p.rot += p.vr; p.life -= 1;
      const a = Math.max(0, Math.min(1, p.life/220));
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.globalAlpha = a;

      const g = ctx.createLinearGradient(-p.r,-p.r,p.r,p.r);
      g.addColorStop(0, "rgba(255,61,154,0.95)");
      g.addColorStop(0.5,"rgba(96,165,250,0.95)");
      g.addColorStop(1, "rgba(34,197,94,0.95)");
      ctx.fillStyle = g;
      ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2);

      ctx.restore();
    }
    parts = parts.filter(p=>p.life>0 && p.y < H+60);
    if(parts.length) raf = requestAnimationFrame(tick);
    else ctx.clearRect(0,0,W,H);
  }

  // ====== çˆ±å¿ƒé›¨ ======
  function heartsBurst(count=60){
    for(let i=0;i<count;i++){
      const h = document.createElement("div");
      h.className="heart";
      h.textContent = ["ğŸ’–","ğŸ’˜","ğŸ’—","ğŸ’","ğŸ’“"][Math.floor(Math.random()*5)];
      h.style.left = (Math.random()*100) + "vw";
      h.style.animationDuration = (3 + Math.random()*3) + "s";
      h.style.fontSize = (16 + Math.random()*16) + "px";
      h.style.opacity = (0.65 + Math.random()*0.35).toFixed(2);
      document.body.appendChild(h);
      setTimeout(()=>h.remove(), 6500);
    }
  }
  setInterval(()=>{ if(Math.random()<0.35) heartsBurst(4); }, 900);

  // ====== å¼¹çª—ï¼šä¸æ„¿æ„é€ƒè·‘ + ç‚¹ä¸æ„¿æ„è¦æ±‚é‡é€‰ ======
  function showPopup(){
    popup.style.display="flex";
    renderChoiceUI();
    moveNoBtn(true);
  }
  function hidePopup(){ popup.style.display="none"; }
  closeX.addEventListener("click", hidePopup);
  popup.addEventListener("click", (e)=>{ if(e.target===popup) hidePopup(); });

  function renderChoiceUI(){
    popupInner.innerHTML = `
      <h2>ä½ æ„¿æ„åšæˆ‘çš„å¥³æœ‹å‹å—ï¼ŸğŸ’–</h2>
      <div class="popupHint">ï¼ˆè®¤çœŸé€‰ä¸€ä¸‹å“¦ï¼‰</div>
      <div class="chooseArea" id="chooseArea">
        <button class="yesBtn" id="yesBtn">æ„¿æ„ ğŸ’•</button>
        <button class="noBtn" id="noBtn">ä¸æ„¿æ„ ğŸ™ˆ</button>
      </div>
      <div style="margin-top:12px;color:#111827;font-weight:900;font-size:13px;line-height:1.6;">
        é€‰å®Œå°±å¯ä»¥é¢†å–ç¤¼ç‰©å•¦ã€‚
      </div>
    `;

    const yesBtn = document.getElementById("yesBtn");
    const noBtn  = document.getElementById("noBtn");
    const area   = document.getElementById("chooseArea");

    yesBtn.addEventListener("click", ()=>{
      popupInner.innerHTML = `
        <h2>ä»ä»Šå¤©å¼€å§‹ï¼Œä½ å°±æ˜¯æˆ‘çš„å¥³æœ‹å‹äº† ğŸ’•</h2>
        <div style="margin-top:10px;color:#111827;font-weight:1000;line-height:1.7;">
          ä»¥åæ¯ä¸€ä¸ªèŠ‚æ—¥ã€æ¯ä¸€æ¬¡å¼€å¿ƒã€æ¯ä¸€æ¬¡å§”å±ˆï¼Œ<br>
          æˆ‘éƒ½æƒ³ä»¥ç”·æœ‹å‹çš„èº«ä»½é™ªåœ¨ä½ èº«è¾¹ã€‚
        </div>
        <div style="margin-top:14px;color:#7c3aed;font-weight:900;">
          ï¼ˆç¤¼ç‰©æˆ‘éƒ½å‡†å¤‡å¥½äº†ğŸ˜ï¼‰
        </div>
        <div style="margin-top:16px;">
          <button class="btn" id="okBtn">æˆ‘çŸ¥é“å•¦ ğŸ¥°</button>
        </div>
      `;
      document.getElementById("okBtn").addEventListener("click", hidePopup);
      confettiBurst(); heartsBurst(90);
    });

    noBtn.addEventListener("click", ()=>{
      popupInner.innerHTML = `
        <h2>å†é€‰ä¸€æ¬¡ ğŸ˜</h2>
        <div class="popupHint">ä½ æ˜¯ä¸æ˜¯ç‚¹é”™äº†ï¼Ÿ</div>
        <div style="margin-top:10px;color:#111827;font-weight:1000;">æ²¡å…³ç³»ï¼Œé‡æ–°æ¥ï½</div>
        <div style="margin-top:14px;">
          <button class="btn" id="againBtn">é‡æ–°é€‰æ‹©</button>
        </div>
      `;
      document.getElementById("againBtn").addEventListener("click", ()=>{
        renderChoiceUI();
        moveNoBtn(true);
      });
    });

    attachEscape(noBtn, area);
  }

  function rand(min,max){ return min + Math.random()*(max-min); }
  function moveNoBtn(isFirst=false){
    const no = document.getElementById("noBtn");
    const area = document.getElementById("chooseArea");
    if(!no || !area) return;

    const pad = 10;
    const areaW = area.clientWidth;
    const areaH = area.clientHeight;
    const btnW = no.offsetWidth || 96;
    const btnH = no.offsetHeight || 42;

    let x, y, tries=0;
    do{
      x = rand(pad, areaW - btnW - pad);
      y = rand(pad, areaH - btnH - pad);
      tries++;
    }while(tries<14 && x < 160 && y > 40 && y < 130);

    no.style.left = x + "px";
    no.style.top  = y + "px";
    no.style.transform = isFirst ? "scale(1)" : `scale(${rand(.9,1.08).toFixed(2)})`;
  }
  function attachEscape(no, area){
    const run = ()=>moveNoBtn(false);
    no.addEventListener("mouseenter", run);
    no.addEventListener("pointerdown", (e)=>{ e.preventDefault(); run(); });
    area.addEventListener("pointermove", (e)=>{
      const rect = no.getBoundingClientRect();
      const dx = e.clientX - (rect.left + rect.width/2);
      const dy = e.clientY - (rect.top  + rect.height/2);
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < 95) run();
    });
  }

  // ====== æŠ½å¥–ï¼šLOVE å”¯ä¸€å¼€å§‹é”®ï¼ˆâœ…æ¯æ¬¡éƒ½èƒ½é‡è½¬ã€æ°¸è¿œé”å®šåŒä¸€æ‰‡åŒºï¼‰=====
  function startSpin(){
    if(spinning) return;
    spinning = true;

    result.classList.remove("shake");
    result.innerHTML = `ä½ å¯èƒ½æœªä¸­å¥–â€¦`;

    const fakePool = ["æ²¡ä¸­å¥–","ğŸ“¸ æ‹ç«‹å¾—","ğŸ¶ çº¿æ¡å°ç‹—","ğŸŒ¹ é²œèŠ±","ğŸ’– è·å¾—æ‰€æœ‰ç¤¼å“"];
    let t = 0;
    const timer = setInterval(()=>{
      const preview = fakePool[Math.floor(Math.random()*fakePool.length)];
      result.innerHTML = `ä½ å¯èƒ½æœªä¸­å¥–â€¦<br><span style="font-size:13px;opacity:.92;">ï¼ˆä¹Ÿå¯èƒ½ä¼šæŠ½åˆ°ï¼š<b>${preview}</b>ï¼‰</span>`;
      t++;
      if(t>=7) clearInterval(timer);
    }, 420);

    const spins = 9; // æ¯æ¬¡å›ºå®šè½¬ 9 åœˆ
    const align = alignAngleToIndex(WIN_INDEX) + CORRECTION_DEG;

    // âœ… å½’ä¸€åŒ–å½“å‰è§’åº¦ï¼Œæ¶ˆæ‰ç´¯è®¡è¯¯å·®ï¼ˆå…³é”®ï¼‰
    const now = ((currentRotation % 360) + 360) % 360;
    currentRotation = currentRotation - now + spins*360 + align;

    wheelEl.style.transform = `rotate(${currentRotation}deg)`;

    setTimeout(()=>{
      result.classList.add("shake");
      result.innerHTML = `
        <div class="winTitle">ğŸ‰ æ­å–œä½ è·å¾—ï¼š</div>
        ğŸ“¸ æ‹ç«‹å¾— + ğŸ¶ çº¿æ¡å°ç‹— + ğŸŒ¹ é²œèŠ± + ğŸ’– è·å¾—æ‰€æœ‰ç¤¼å“<br><br>
        <button class="btn" id="claimBtn">ç‚¹å‡»é¢†å–</button>
      `;
      confettiBurst();
      heartsBurst(55);

      document.getElementById("claimBtn").addEventListener("click", showPopup);
      spinning = false;
    }, 4900);
  }

  loveBtn.addEventListener("pointerdown", async (e)=>{
    e.preventDefault();
    await unlockAudio();
    startSpin();
  });
</script>
</body>
</html>

