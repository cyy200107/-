<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>å¹¸è¿è½¬ç›˜ ğŸ’–</title>

<style>
  :root{
    --wheelSize: 360px;
    --border: 12px;
    --glass: rgba(255,255,255,.16);
    --glass2: rgba(255,255,255,.22);
    --ink:#0b1220;
    --hot:#ff3d9a;
    --pink:#fb7185;
    --sky:#60a5fa;
    --mint:#22c55e;
  }
  *{ box-sizing:border-box; }
  body{
    margin:0; overflow:hidden;
    font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",system-ui,Arial,sans-serif;
    color:#fff;
    text-align:center;
    background:
      radial-gradient(900px 650px at 20% 20%, rgba(96,165,250,.35), transparent 60%),
      radial-gradient(900px 650px at 80% 25%, rgba(34,197,94,.25), transparent 60%),
      radial-gradient(900px 650px at 60% 80%, rgba(251,113,133,.34), transparent 60%),
      linear-gradient(135deg,#ff9a9e,#fad0c4);
  }

  /* èƒŒæ™¯æµå…‰ */
  .blob{
    position:fixed; pointer-events:none;
    width:520px; height:520px; border-radius:50%;
    filter: blur(44px);
    opacity:.42;
    animation: drift 14s ease-in-out infinite;
  }
  .b1{ left:-140px; top:-170px; background: radial-gradient(circle at 30% 30%, rgba(96,165,250,.95), transparent 60%); }
  .b2{ right:-170px; top:40px; background: radial-gradient(circle at 30% 30%, rgba(34,197,94,.85), transparent 60%); animation-duration:16s;}
  .b3{ left:110px; bottom:-220px; background: radial-gradient(circle at 30% 30%, rgba(251,113,133,.9), transparent 60%); animation-duration:18s;}
  @keyframes drift{
    0%,100%{ transform: translate(0,0) scale(1); }
    50%{ transform: translate(70px, 40px) scale(1.06); }
  }

  h1{
    margin:22px 12px 8px;
    font-size:26px;
    letter-spacing:.6px;
    text-shadow:0 14px 40px rgba(0,0,0,.25);
  }
  .sub{
    margin:0 16px 16px;
    font-size:14px;
    line-height:1.7;
    color:rgba(255,255,255,.9);
    text-shadow:0 10px 28px rgba(0,0,0,.14);
  }

  .card{
    width:min(560px, 92vw);
    margin:0 auto;
    border-radius:22px;
    border:1px solid rgba(255,255,255,.28);
    background: var(--glass);
    backdrop-filter: blur(12px);
    box-shadow: 0 28px 90px rgba(0,0,0,.18);
    padding:18px 14px 16px;
  }

  .wrap{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:14px;
    padding-top:6px;
  }

  /* æŒ‡é’ˆ */
  .pointer{
    position:relative;
    width:0;height:0;
    border-left:16px solid transparent;
    border-right:16px solid transparent;
    border-bottom:36px solid rgba(255,255,255,.96);
    filter: drop-shadow(0 10px 14px rgba(0,0,0,.28));
    z-index:15;
    margin-top:2px;
  }
  .pointer::after{
    content:"";
    position:absolute;
    left:-8px; top:31px;
    width:16px; height:16px;
    background:rgba(255,255,255,.96);
    border-radius:999px;
    box-shadow: 0 10px 24px rgba(0,0,0,.18);
  }

  /* è½¬ç›˜å£³ */
  .wheelShell{
    width: var(--wheelSize);
    height: var(--wheelSize);
    border-radius:50%;
    border: var(--border) solid rgba(255,255,255,.95);
    position:relative;
    overflow:hidden;
    box-shadow:
      0 24px 85px rgba(0,0,0,.26),
      0 0 0 6px rgba(255,255,255,.18),
      0 0 40px rgba(255,255,255,.55);
    background: rgba(255,255,255,.08);
    backdrop-filter: blur(12px);
  }

  /* çœŸæ­£æ—‹è½¬å±‚ */
  #wheel{
    position:absolute; inset:0;
    border-radius:50%;
    transition: transform 4.8s cubic-bezier(.2,1,.25,1);
    background: conic-gradient(
      #d1d5db 0deg 36deg,
      #e5e7eb 36deg 72deg,
      #d1d5db 72deg 108deg,
      #e5e7eb 108deg 144deg,
      #d1d5db 144deg 180deg,
      #e5e7eb 180deg 216deg,
      rgba(255,159,243,.95) 216deg 252deg,
      rgba(254,202,87,.95) 252deg 288deg,
      rgba(72,219,251,.95) 288deg 324deg,
      rgba(255,107,107,.95) 324deg 360deg
    );
  }

  /* åˆ†å‰²çº¿ */
  .divider{
    position:absolute; inset:0;
    border-radius:50%;
    pointer-events:none;
    background:
      repeating-conic-gradient(from -90deg,
        rgba(255,255,255,.85) 0deg 1.3deg,
        transparent 1.3deg 36deg
      );
    mix-blend-mode: overlay;
    opacity:.85;
  }

  /* æ ‡ç­¾å±‚ */
  #labels{
    position:absolute; inset:0;
    border-radius:50%;
    pointer-events:none;
  }
  .label{
    position:absolute;
    top:50%; left:50%;
    transform-origin: 0 0;
    font-size:14px;
    font-weight:1000;
    text-shadow:0 2px 12px rgba(0,0,0,.35);
    white-space:nowrap;
    user-select:none;
  }
  .label.small{ font-size:13px; }

  /* ä¸­å¿ƒ */
  .hub{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%);
    width:92px; height:92px;
    border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,255,255,.75));
    box-shadow: 0 18px 44px rgba(0,0,0,.25);
    display:grid; place-items:center;
    z-index:10;
    user-select:none;
  }
  .hub .pulse{
    width:78px; height:78px;
    border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,61,154,.9), rgba(251,113,133,.75));
    display:grid; place-items:center;
    color:#fff;
    font-weight:1000;
    letter-spacing:.8px;
    box-shadow: 0 0 24px rgba(255,61,154,.55);
    animation: pulse 1.4s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ transform: scale(1); filter: brightness(1); }
    50%{ transform: scale(1.06); filter: brightness(1.08); }
  }

  /* æŒ‰é’® */
  .btnRow{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  .btn{
    border:none; cursor:pointer;
    border-radius:999px;
    padding:12px 18px;
    font-size:15px;
    font-weight:1000;
    background: rgba(255,255,255,.92);
    color: var(--ink);
    box-shadow: 0 16px 34px rgba(0,0,0,.18);
    transition: transform .08s ease, filter .2s ease;
  }
  .btn:active{ transform: translateY(1px); }
  .btn[disabled]{ cursor:not-allowed; filter: brightness(.85); }

  /* ç»“æœæ¡† */
  #result{
    margin-top:4px;
    width:min(520px, 92vw);
    padding:14px 14px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.28);
    background: var(--glass2);
    backdrop-filter: blur(10px);
    box-shadow: 0 18px 44px rgba(0,0,0,.12);
    font-size:15px;
    line-height:1.75;
  }
  .winTitle{
    font-size:18px;
    font-weight:1000;
    margin-bottom:4px;
  }
  .shake{ animation: shake .22s ease-in-out 2; }
  @keyframes shake{
    0%,100%{ transform: translateX(0); }
    25%{ transform: translateX(-3px); }
    75%{ transform: translateX(3px); }
  }

  /* å¼¹çª— */
  #popup{
    display:none;
    position:fixed; inset:0;
    background: rgba(0,0,0,.78);
    justify-content:center; align-items:center;
    padding:18px;
    z-index:99;
  }
  .popupBox{
    width:min(390px, 92vw);
    border-radius:22px;
    border:1px solid rgba(255,255,255,.25);
    background: rgba(255,255,255,.92);
    color: var(--hot);
    box-shadow: 0 30px 120px rgba(0,0,0,.35);
    padding:22px 18px 18px;
    position:relative;
    overflow:hidden;
  }
  .popupBox::before{
    content:"";
    position:absolute; inset:-40px;
    background:
      radial-gradient(circle at 20% 30%, rgba(255,61,154,.28), transparent 60%),
      radial-gradient(circle at 80% 20%, rgba(96,165,250,.25), transparent 60%),
      radial-gradient(circle at 60% 90%, rgba(34,197,94,.18), transparent 60%);
    filter: blur(12px);
    opacity:.9;
    pointer-events:none;
  }
  .popupInner{ position:relative; z-index:2; }
  .popupBox h2{
    margin:4px 0 10px;
    font-size:18px;
    font-weight:1000;
  }
  .popupHint{
    margin:0 0 14px;
    color:#7c3aed;
    font-weight:900;
    font-size:13px;
  }
  .chooseArea{
    position:relative;
    height:140px;
    border-radius:16px;
    background: rgba(255,255,255,.58);
    border:1px dashed rgba(255,61,154,.35);
    overflow:hidden;
  }
  .yesBtn, .noBtn{
    position:absolute;
    border-radius:999px;
    padding:12px 18px;
    font-size:15px;
    font-weight:1000;
    border:none;
    cursor:pointer;
    box-shadow: 0 16px 34px rgba(0,0,0,.12);
    user-select:none;
  }
  .yesBtn{
    left:18px; top:52px;
    background: linear-gradient(90deg, var(--hot), var(--pink));
    color:#fff;
  }
  .noBtn{
    left:218px; top:54px;
    background: rgba(17,24,39,.10);
    color:#111827;
    transition: left .16s ease, top .16s ease, transform .16s ease;
  }
  .closeX{
    position:absolute;
    right:10px; top:8px;
    width:34px; height:34px;
    border-radius:999px;
    border:none;
    cursor:pointer;
    background: rgba(0,0,0,.08);
    color:#111827;
    font-weight:1000;
    z-index:5;
  }

  /* çˆ±å¿ƒé›¨ */
  .heart{
    position:fixed;
    top:-12px;
    font-size:20px;
    animation: fall 6s linear infinite;
    pointer-events:none;
    z-index:70;
    filter: drop-shadow(0 10px 10px rgba(0,0,0,.2));
  }
  @keyframes fall{ to{ transform: translateY(110vh); opacity:0; } }

  canvas{ position:fixed; inset:0; pointer-events:none; z-index:80; }

  @media (max-width:390px){
    :root{ --wheelSize: 320px; }
  }
</style>
</head>

<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
  <canvas id="fx"></canvas>

  <h1>å¹¸è¿è½¬ç›˜ ğŸ’–</h1>
  <div class="sub">ç‚¹ä¸€ä¸‹å¼€å§‹è½¬ï¼Œçœ‹ä»Šå¤©çš„è¿æ°”è½åœ¨å“ªä¸€æ ¼ã€‚</div>

  <div class="card">
    <div class="wrap">
      <div class="pointer" aria-hidden="true"></div>

      <div class="wheelShell">
        <div id="wheel">
          <div id="labels"></div>
        </div>
        <div class="divider"></div>
        <div class="hub"><div class="pulse">LOVE</div></div>
      </div>

      <div class="btnRow">
        <button class="btn" id="spinBtn">å¼€å§‹è½¬</button>
        <button class="btn" id="musicBtn">éŸ³ä¹ï¼šå¼€</button>
      </div>

      <div id="result">å‡†å¤‡å¥½äº†å—ï¼Ÿç‚¹ã€Œå¼€å§‹è½¬ã€å°±å¼€å§‹ã€‚</div>
    </div>
  </div>

  <!-- æš§æ˜§æµªæ¼« BGMï¼ˆç‚¹å¼€å§‹è½¬æ‰ä¼šæ’­æ”¾ï¼‰ -->
  <audio id="bgm" loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5a6fa2e1f3.mp3?filename=romantic-background-112199.mp3" type="audio/mp3">
  </audio>

  <!-- è¡¨ç™½å¼¹çª— -->
  <div id="popup">
    <div class="popupBox">
      <button class="closeX" id="closeX">Ã—</button>
      <div class="popupInner" id="popupInner">
        <h2>ä½ æ„¿æ„åšæˆ‘çš„å¥³æœ‹å‹å—ï¼ŸğŸ’–</h2>
        <div class="popupHint">ï¼ˆåˆ«ç´§å¼ ï¼Œè®¤çœŸé€‰ä¸€ä¸‹ï¼‰</div>

        <div class="chooseArea" id="chooseArea">
          <button class="yesBtn" id="yesBtn">æ„¿æ„ ğŸ’•</button>
          <button class="noBtn" id="noBtn">ä¸æ„¿æ„ ğŸ™ˆ</button>
        </div>

        <div style="margin-top:12px;color:#111827;font-weight:900;font-size:13px;line-height:1.6;">
          é€‰å®Œå°±å¯ä»¥é¢†å–ä½ çš„ç¤¼ç‰©å•¦ã€‚
        </div>
      </div>
    </div>
  </div>

<script>
/* ========== DOM ========== */
const wheel = document.getElementById("wheel");
const labels = document.getElementById("labels");
const spinBtn = document.getElementById("spinBtn");
const result = document.getElementById("result");

const popup = document.getElementById("popup");
const closeX = document.getElementById("closeX");
const popupInner = document.getElementById("popupInner");
const chooseArea = document.getElementById("chooseArea");
const yesBtn = document.getElementById("yesBtn");
const noBtn = document.getElementById("noBtn");

const bgm = document.getElementById("bgm");
const musicBtn = document.getElementById("musicBtn");

/* ========== è½¬ç›˜æ•°æ®ï¼ˆä¸éœ²é¦…ï¼šä¸å†™å¿…ä¸­æç¤ºï¼‰ ========== */
const prizes = [
  "æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–",
  "ğŸ“¸ æ‹ç«‹å¾—","ğŸ¶ çº¿æ¡å°ç‹—","ğŸŒ¹ é²œèŠ±","ğŸ’– è·å¾—æ‰€æœ‰ç¤¼å“"
];
const N = prizes.length;     // 10
const STEP = 360 / N;        // 36Â°
const POINTER_AT = -90;      // 12ç‚¹æ–¹å‘
const WIN_INDEX = 9;         // å®é™…æ°¸è¿œå‘½ä¸­æœ€åä¸€æ ¼ï¼ˆä¸å±•ç¤ºé€»è¾‘ï¼‰

/* ç”Ÿæˆæ‰‡åŒºæ–‡å­— */
const r = 128;
prizes.forEach((text,i)=>{
  const centerAngle = POINTER_AT + i*STEP + STEP/2;
  const el = document.createElement("div");
  el.className = "label" + (text.length>=6 ? " small" : "");
  el.textContent = text;
  el.style.color = (text==="æ²¡ä¸­å¥–") ? "#6b7280" : "#111827";
  el.style.transform =
    `rotate(${centerAngle}deg) translate(${r}px, -10px) rotate(${-centerAngle}deg) translate(-50%, 0)`;
  labels.appendChild(el);
});

/* è®¡ç®—æ—‹è½¬è§’ï¼ˆæœ€ç»ˆè½åœ¨ WIN_INDEX ä¸­å¿ƒï¼‰ */
function computeRotationToLandOn(index){
  const winCenter = POINTER_AT + index*STEP + STEP/2;
  const baseRotation = POINTER_AT - winCenter;
  const spins = 9;
  return spins*360 + baseRotation;
}

/* ========== éŸ³ä¹ ========== */
let musicOn = true;
async function playMusic(){
  if(!musicOn) return;
  try{ await bgm.play(); }catch(e){}
}
function toggleMusic(){
  musicOn = !musicOn;
  if(musicOn){
    musicBtn.textContent = "éŸ³ä¹ï¼šå¼€";
    playMusic();
  }else{
    musicBtn.textContent = "éŸ³ä¹ï¼šå…³";
    bgm.pause();
  }
}
musicBtn.addEventListener("click", toggleMusic);

/* ========== æŠ½å¥–ï¼šçœ‹èµ·æ¥éšæœºä½†ä¸éœ²é¦… ========== */
spinBtn.addEventListener("click", async ()=>{
  spinBtn.disabled = true;
  await playMusic();

  // å…ˆâ€œéšæœºé¢„å‘Šâ€ï¼Œåˆ¶é€ æ‚¬å¿µï¼ˆä¸å½±å“æœ€ç»ˆç»“æœï¼‰
  const fakePool = ["æ²¡ä¸­å¥–","ğŸ“¸ æ‹ç«‹å¾—","ğŸ¶ çº¿æ¡å°ç‹—","ğŸŒ¹ é²œèŠ±","ğŸ’– è·å¾—æ‰€æœ‰ç¤¼å“"];
  const preview = fakePool[Math.floor(Math.random()*fakePool.length)];
  result.classList.remove("shake");
  result.innerHTML = `è½¬ç›˜å¯åŠ¨ä¸­â€¦ğŸ’ å¯èƒ½ä¼šæŠ½åˆ°ï¼š<b>${preview}</b>`;

  // å°æŠ–åŠ¨è®©è§†è§‰æ›´åƒéšæœºï¼Œä½†ä»è½åœ¨åŒä¸€æ ¼èŒƒå›´
  const wiggle = (Math.random()*8 - 4);
  const rotation = computeRotationToLandOn(WIN_INDEX) + wiggle;
  wheel.style.transform = `rotate(${rotation}deg)`;

  setTimeout(()=>{
    result.classList.add("shake");
    result.innerHTML = `
      <div class="winTitle">ğŸ‰ æ­å–œä½ è·å¾—ï¼š</div>
      ğŸ“¸ æ‹ç«‹å¾— + ğŸ¶ çº¿æ¡å°ç‹— + ğŸŒ¹ é²œèŠ± + ğŸ’– è·å¾—æ‰€æœ‰ç¤¼å“<br><br>
      <button class="btn" id="claimBtn">ç‚¹å‡»é¢†å–</button>
    `;
    confettiBurst();
    heartsBurst(40);

    document.getElementById("claimBtn").addEventListener("click", showPopup);
    spinBtn.disabled = false;
  }, 4900);
});

/* ========== å¼¹çª— ========== */
function showPopup(){
  popup.style.display="flex";
  playMusic();
  resetChoiceUI();
  moveNoBtn(true);
}
function hidePopup(){ popup.style.display="none"; }
closeX.addEventListener("click", hidePopup);
popup.addEventListener("click", (e)=>{ if(e.target===popup) hidePopup(); });

/* é‡æ–°æ¸²æŸ“é€‰æ‹© UIï¼ˆç”¨äºâ€œä¸æ„¿æ„ => å†é€‰ä¸€æ¬¡â€å›åˆ°åŸç•Œé¢ï¼‰ */
function resetChoiceUI(){
  popupInner.innerHTML = `
    <h2>ä½ æ„¿æ„åšæˆ‘çš„å¥³æœ‹å‹å—ï¼ŸğŸ’–</h2>
    <div class="popupHint">ï¼ˆåˆ«ç´§å¼ ï¼Œè®¤çœŸé€‰ä¸€ä¸‹ï¼‰</div>
    <div class="chooseArea" id="chooseAreaInner">
      <button class="yesBtn" id="yesBtnInner">æ„¿æ„ ğŸ’•</button>
      <button class="noBtn" id="noBtnInner">ä¸æ„¿æ„ ğŸ™ˆ</button>
    </div>
    <div style="margin-top:12px;color:#111827;font-weight:900;font-size:13px;line-height:1.6;">
      é€‰å®Œå°±å¯ä»¥é¢†å–ä½ çš„ç¤¼ç‰©å•¦ã€‚
    </div>
  `;

  const yes = document.getElementById("yesBtnInner");
  const no  = document.getElementById("noBtnInner");
  const area= document.getElementById("chooseAreaInner");

  // æ„¿æ„ï¼šæˆåŠŸç»“å±€
  yes.addEventListener("click", ()=>{
    popupInner.innerHTML = `
      <h2>ä»ä»Šå¤©å¼€å§‹ï¼Œä½ å°±æ˜¯æˆ‘çš„å¥³æœ‹å‹äº† ğŸ’•</h2>
      <div style="margin-top:10px;color:#111827;font-weight:1000;line-height:1.7;">
        ä»¥åæ¯ä¸€ä¸ªèŠ‚æ—¥ã€æ¯ä¸€æ¬¡å¼€å¿ƒã€æ¯ä¸€æ¬¡å§”å±ˆï¼Œ<br>
        æˆ‘éƒ½æƒ³ä»¥ç”·æœ‹å‹çš„èº«ä»½é™ªåœ¨ä½ èº«è¾¹ã€‚
      </div>
      <div style="margin-top:14px;color:#7c3aed;font-weight:900;">
        ï¼ˆç¤¼ç‰©æˆ‘éƒ½å‡†å¤‡å¥½äº†ğŸ˜ï¼‰
      </div>
      <div style="margin-top:16px;">
        <button class="btn" id="okBtn">æˆ‘çŸ¥é“å•¦ ğŸ¥°</button>
      </div>
    `;
    document.getElementById("okBtn").addEventListener("click", hidePopup);
    confettiBurst();
    heartsBurst(90);
  });

  // ä¸æ„¿æ„ï¼šå¦‚æœçœŸçš„ç‚¹åˆ°äº† -> â€œå†é€‰ä¸€æ¬¡â€ -> å›åˆ°é€‰æ‹©ç•Œé¢
  no.addEventListener("click", ()=>{
    popupInner.innerHTML = `
      <h2>å†é€‰ä¸€æ¬¡ ğŸ˜</h2>
      <div class="popupHint">ä½ æ˜¯ä¸æ˜¯ç‚¹é”™äº†ï¼Ÿ</div>
      <div style="margin-top:10px;color:#111827;font-weight:1000;">
        æ²¡å…³ç³»ï¼Œé‡æ–°æ¥ï½
      </div>
      <div style="margin-top:14px;">
        <button class="btn" id="againBtn">é‡æ–°é€‰æ‹©</button>
      </div>
    `;
    document.getElementById("againBtn").addEventListener("click", ()=>{
      resetChoiceUI();
      // é‡æ–°æ‹¿åˆ°æ–°çš„ no/areaï¼Œå†è®©å®ƒç»§ç»­é€ƒè·‘
      const newNo = document.getElementById("noBtnInner");
      const newArea= document.getElementById("chooseAreaInner");
      attachEscape(newNo, newArea);
      moveNoBtn(true);
    });
  });

  // ç»‘å®šé€ƒè·‘é€»è¾‘
  attachEscape(no, area);
}

function rand(min,max){ return min + Math.random()*(max-min); }

function moveNoBtn(isFirst=false){
  const no = document.getElementById("noBtnInner");
  const area = document.getElementById("chooseAreaInner");
  if(!no || !area) return;

  const pad = 10;
  const areaW = area.clientWidth;
  const areaH = area.clientHeight;
  const btnW = no.offsetWidth || 96;
  const btnH = no.offsetHeight || 42;

  let x, y, tries=0;
  do{
    x = rand(pad, areaW - btnW - pad);
    y = rand(pad, areaH - btnH - pad);
    tries++;
  }while(tries<12 && x < 150 && y > 30 && y < 115);

  no.style.left = x + "px";
  no.style.top  = y + "px";
  no.style.transform = isFirst ? "scale(1)" : `scale(${rand(.92,1.06).toFixed(2)})`;
}

/* é€ƒè·‘ç»‘å®šï¼šé è¿‘å°±è·‘ + è§¦æ‘¸å°±è·‘ + é è¿‘èŒƒå›´ä¹Ÿè·‘ */
function attachEscape(no, area){
  const run = ()=>moveNoBtn(false);

  no.addEventListener("mouseenter", run);
  no.addEventListener("touchstart", (e)=>{ e.preventDefault(); run(); }, {passive:false});

  area.addEventListener("mousemove", (e)=>{
    const rect = no.getBoundingClientRect();
    const dx = e.clientX - (rect.left + rect.width/2);
    const dy = e.clientY - (rect.top  + rect.height/2);
    const dist = Math.sqrt(dx*dx + dy*dy);
    if(dist < 90) run();
  });
}

/* ========== Canvas å½©å¸¦ ========== */
const canvas = document.getElementById("fx");
const ctx = canvas.getContext("2d");
let W=0,H=0,parts=[],raf=null;

function resize(){
  W = canvas.width = innerWidth;
  H = canvas.height = innerHeight;
}
addEventListener("resize", resize);
resize();

function confettiBurst(){
  parts = [];
  for(let i=0;i<190;i++){
    parts.push({
      x: Math.random()*W,
      y: -30 - Math.random()*H*0.15,
      vx: -3 + Math.random()*6,
      vy: 3 + Math.random()*8,
      r: 3 + Math.random()*6,
      rot: Math.random()*Math.PI,
      vr: -0.25 + Math.random()*0.5,
      life: 140 + Math.random()*70
    });
  }
  if(raf) cancelAnimationFrame(raf);
  tick();
}
function tick(){
  ctx.clearRect(0,0,W,H);
  for(const p of parts){
    p.x += p.vx;
    p.y += p.vy;
    p.vy *= 1.01;
    p.rot += p.vr;
    p.life -= 1;

    const a = Math.max(0, Math.min(1, p.life/190));
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rot);
    ctx.globalAlpha = a;

    const g = ctx.createLinearGradient(-p.r,-p.r,p.r,p.r);
    g.addColorStop(0, "rgba(255,61,154,0.95)");
    g.addColorStop(0.5,"rgba(96,165,250,0.95)");
    g.addColorStop(1, "rgba(34,197,94,0.95)");
    ctx.fillStyle = g;
    ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2);

    ctx.restore();
  }
  parts = parts.filter(p=>p.life>0 && p.y < H+60);
  if(parts.length) raf = requestAnimationFrame(tick);
  else ctx.clearRect(0,0,W,H);
}

/* ========== çˆ±å¿ƒé›¨ ========== */
function heartsBurst(count=60){
  for(let i=0;i<count;i++){
    const h = document.createElement("div");
    h.className="heart";
    h.textContent = ["ğŸ’–","ğŸ’˜","ğŸ’—","ğŸ’","ğŸ’“"][Math.floor(Math.random()*5)];
    h.style.left = (Math.random()*100) + "vw";
    h.style.animationDuration = (3 + Math.random()*3) + "s";
    h.style.fontSize = (16 + Math.random()*14) + "px";
    h.style.opacity = (0.65 + Math.random()*0.35).toFixed(2);
    document.body.appendChild(h);
    setTimeout(()=>h.remove(), 6500);
  }
}
setInterval(()=>{ if(Math.random()<0.35) heartsBurst(4); }, 900);
</script>
</body>
</html>
