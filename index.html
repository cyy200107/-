<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ä¸“å±å¹¸è¿è½¬ç›˜ ğŸ’–</title>

<style>
  :root{
    --wheelSize: 360px;
    --border: 12px;
    --glass: rgba(255,255,255,.16);
    --glass2: rgba(255,255,255,.22);
    --ink:#0b1220;
    --hot:#ff3d9a;
    --pink:#fb7185;
    --sky:#60a5fa;
    --mint:#22c55e;
  }
  *{ box-sizing:border-box; }
  body{
    margin:0; overflow:hidden;
    font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",system-ui,Arial,sans-serif;
    color:#fff;
    text-align:center;
    background:
      radial-gradient(900px 650px at 20% 20%, rgba(96,165,250,.35), transparent 60%),
      radial-gradient(900px 650px at 80% 25%, rgba(34,197,94,.25), transparent 60%),
      radial-gradient(900px 650px at 60% 80%, rgba(251,113,133,.34), transparent 60%),
      linear-gradient(135deg,#ff9a9e,#fad0c4);
  }

  /* èƒŒæ™¯æµå…‰ blob */
  .blob{
    position:fixed; pointer-events:none;
    width:520px; height:520px; border-radius:50%;
    filter: blur(44px);
    opacity:.42;
    animation: drift 14s ease-in-out infinite;
  }
  .b1{ left:-140px; top:-170px; background: radial-gradient(circle at 30% 30%, rgba(96,165,250,.95), transparent 60%); }
  .b2{ right:-170px; top:40px; background: radial-gradient(circle at 30% 30%, rgba(34,197,94,.85), transparent 60%); animation-duration:16s;}
  .b3{ left:110px; bottom:-220px; background: radial-gradient(circle at 30% 30%, rgba(251,113,133,.9), transparent 60%); animation-duration:18s;}
  @keyframes drift{
    0%,100%{ transform: translate(0,0) scale(1); }
    50%{ transform: translate(70px, 40px) scale(1.06); }
  }

  /* é¡¶éƒ¨æ ‡é¢˜ */
  h1{
    margin:24px 12px 8px;
    font-size:26px;
    letter-spacing:.6px;
    text-shadow:0 14px 40px rgba(0,0,0,.25);
  }
  .sub{
    margin:0 16px 18px;
    font-size:14px;
    line-height:1.7;
    color:rgba(255,255,255,.9);
    text-shadow:0 10px 28px rgba(0,0,0,.14);
  }

  /* å¡ç‰‡å®¹å™¨ */
  .card{
    width:min(560px, 92vw);
    margin:0 auto;
    border-radius:22px;
    border:1px solid rgba(255,255,255,.28);
    background: var(--glass);
    backdrop-filter: blur(12px);
    box-shadow: 0 28px 90px rgba(0,0,0,.18);
    padding:18px 14px 16px;
  }

  /* å¼€å§‹ç•Œé¢ */
  .startArea{
    display:flex; flex-direction:column; gap:12px;
    align-items:center; justify-content:center;
    padding:10px 8px 16px;
  }
  .bigBtn{
    border:none;
    border-radius:999px;
    padding:14px 40px;
    font-weight:1000;
    font-size:18px;
    cursor:pointer;
    color:#fff;
    background: linear-gradient(90deg, var(--hot), var(--pink));
    box-shadow:0 18px 46px rgba(255,61,154,.35);
    transition: transform .12s ease, filter .2s ease;
  }
  .bigBtn:active{ transform: translateY(1px) scale(.99); }
  .tip{
    font-size:13px;
    color:rgba(255,255,255,.86);
  }

  /* è½¬ç›˜åŒºåŸŸ */
  .gameArea{
    display:none;
    padding:6px 8px 14px;
  }
  .wrap{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:14px;
    padding-top:8px;
  }

  /* æŒ‡é’ˆ */
  .pointer{
    position:relative;
    width:0;height:0;
    border-left:16px solid transparent;
    border-right:16px solid transparent;
    border-bottom:36px solid rgba(255,255,255,.96);
    filter: drop-shadow(0 10px 14px rgba(0,0,0,.28));
    z-index:15;
    margin-top:2px;
  }
  .pointer::after{
    content:"";
    position:absolute;
    left:-8px; top:31px;
    width:16px; height:16px;
    background:rgba(255,255,255,.96);
    border-radius:999px;
    box-shadow: 0 10px 24px rgba(0,0,0,.18);
  }

  /* è½¬ç›˜å£³ */
  .wheelShell{
    width: var(--wheelSize);
    height: var(--wheelSize);
    border-radius:50%;
    border: var(--border) solid rgba(255,255,255,.95);
    position:relative;
    overflow:hidden;
    box-shadow:
      0 24px 85px rgba(0,0,0,.26),
      0 0 0 6px rgba(255,255,255,.18),
      0 0 40px rgba(255,255,255,.55);
    background: rgba(255,255,255,.08);
    backdrop-filter: blur(12px);
  }

  /* çœŸæ­£æ—‹è½¬å±‚ */
  #wheel{
    position:absolute; inset:0;
    border-radius:50%;
    transition: transform 4.8s cubic-bezier(.2,1,.25,1);
    background: conic-gradient(
      #d1d5db 0deg 36deg,
      #e5e7eb 36deg 72deg,
      #d1d5db 72deg 108deg,
      #e5e7eb 108deg 144deg,
      #d1d5db 144deg 180deg,
      #e5e7eb 180deg 216deg,
      rgba(255,159,243,.95) 216deg 252deg,
      rgba(254,202,87,.95) 252deg 288deg,
      rgba(72,219,251,.95) 288deg 324deg,
      rgba(255,107,107,.95) 324deg 360deg
    );
  }

  /* åˆ†å‰²çº¿ï¼ˆä»12ç‚¹æ–¹å‘å¼€å§‹ï¼‰ */
  .divider{
    position:absolute; inset:0;
    border-radius:50%;
    pointer-events:none;
    background:
      repeating-conic-gradient(from -90deg,
        rgba(255,255,255,.85) 0deg 1.3deg,
        transparent 1.3deg 36deg
      );
    mix-blend-mode: overlay;
    opacity:.85;
  }

  /* æ ‡ç­¾ */
  #labels{
    position:absolute; inset:0;
    border-radius:50%;
    pointer-events:none;
  }
  .label{
    position:absolute;
    top:50%; left:50%;
    transform-origin: 0 0;
    font-size:14px;
    font-weight:1000;
    text-shadow:0 2px 12px rgba(0,0,0,.35);
    white-space:nowrap;
    user-select:none;
  }
  .label.small{ font-size:13px; }

  /* ä¸­å¿ƒ */
  .hub{
    position:absolute; left:50%; top:50%;
    transform:translate(-50%,-50%);
    width:92px; height:92px;
    border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,255,255,.75));
    box-shadow: 0 18px 44px rgba(0,0,0,.25);
    display:grid; place-items:center;
    z-index:10;
    user-select:none;
  }
  .hub .pulse{
    width:78px; height:78px;
    border-radius:50%;
    background: radial-gradient(circle at 30% 30%, rgba(255,61,154,.9), rgba(251,113,133,.75));
    display:grid; place-items:center;
    color:#fff;
    font-weight:1000;
    letter-spacing:.8px;
    box-shadow: 0 0 24px rgba(255,61,154,.55);
    animation: pulse 1.4s ease-in-out infinite;
  }
  @keyframes pulse{
    0%,100%{ transform: scale(1); filter: brightness(1); }
    50%{ transform: scale(1.06); filter: brightness(1.08); }
  }

  /* æ§åˆ¶æŒ‰é’® */
  .btnRow{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; }
  .btn{
    border:none; cursor:pointer;
    border-radius:999px;
    padding:12px 18px;
    font-size:15px;
    font-weight:1000;
    background: rgba(255,255,255,.92);
    color: var(--ink);
    box-shadow: 0 16px 34px rgba(0,0,0,.18);
    transition: transform .08s ease, filter .2s ease;
  }
  .btn:active{ transform: translateY(1px); }
  .btn[disabled]{ cursor:not-allowed; filter: brightness(.85); }

  /* ç»“æœæ¡† */
  #result{
    margin-top:4px;
    width:min(520px, 92vw);
    padding:14px 14px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.28);
    background: var(--glass2);
    backdrop-filter: blur(10px);
    box-shadow: 0 18px 44px rgba(0,0,0,.12);
    font-size:15px;
    line-height:1.75;
  }
  .winTitle{
    font-size:18px;
    font-weight:1000;
    margin-bottom:4px;
  }

  /* å¼¹çª— */
  #popup{
    display:none;
    position:fixed; inset:0;
    background: rgba(0,0,0,.78);
    justify-content:center; align-items:center;
    padding:18px;
    z-index:99;
  }
  .popupBox{
    width:min(390px, 92vw);
    border-radius:22px;
    border:1px solid rgba(255,255,255,.25);
    background: rgba(255,255,255,.92);
    color: var(--hot);
    box-shadow: 0 30px 120px rgba(0,0,0,.35);
    padding:22px 18px 18px;
    position:relative;
    overflow:hidden;
  }
  .popupBox::before{
    content:"";
    position:absolute; inset:-40px;
    background:
      radial-gradient(circle at 20% 30%, rgba(255,61,154,.28), transparent 60%),
      radial-gradient(circle at 80% 20%, rgba(96,165,250,.25), transparent 60%),
      radial-gradient(circle at 60% 90%, rgba(34,197,94,.18), transparent 60%);
    filter: blur(12px);
    opacity:.9;
    pointer-events:none;
  }
  .popupInner{ position:relative; z-index:2; }
  .popupBox h2{
    margin:4px 0 10px;
    font-size:18px;
    font-weight:1000;
  }
  .popupHint{
    margin:0 0 14px;
    color:#7c3aed;
    font-weight:900;
    font-size:13px;
  }
  .chooseArea{
    position:relative;
    height:130px;
    border-radius:16px;
    background: rgba(255,255,255,.58);
    border:1px dashed rgba(255,61,154,.35);
    overflow:hidden;
  }
  .yesBtn, .noBtn{
    position:absolute;
    border-radius:999px;
    padding:12px 18px;
    font-size:15px;
    font-weight:1000;
    border:none;
    cursor:pointer;
    box-shadow: 0 16px 34px rgba(0,0,0,.12);
    user-select:none;
  }
  .yesBtn{
    left:18px; top:44px;
    background: linear-gradient(90deg, var(--hot), var(--pink));
    color:#fff;
  }
  .noBtn{
    left:218px; top:46px;
    background: rgba(17,24,39,.10);
    color:#111827;
    transition: left .16s ease, top .16s ease, transform .16s ease;
  }
  .closeX{
    position:absolute;
    right:10px; top:8px;
    width:34px; height:34px;
    border-radius:999px;
    border:none;
    cursor:pointer;
    background: rgba(0,0,0,.08);
    color:#111827;
    font-weight:1000;
    z-index:5;
  }

  /* çˆ±å¿ƒæ¼‚æµ® */
  .heart{
    position:fixed;
    top:-12px;
    font-size:20px;
    animation: fall 6s linear infinite;
    pointer-events:none;
    z-index:70;
    filter: drop-shadow(0 10px 10px rgba(0,0,0,.2));
  }
  @keyframes fall{ to{ transform: translateY(110vh); opacity:0; } }

  /* è½»å¾®æŠ–åŠ¨ */
  .shake{ animation: shake .22s ease-in-out 2; }
  @keyframes shake{
    0%,100%{ transform: translateX(0); }
    25%{ transform: translateX(-3px); }
    75%{ transform: translateX(3px); }
  }

  /* Canvas ç‰¹æ•ˆå±‚ */
  canvas{ position:fixed; inset:0; pointer-events:none; z-index:80; }

  /* å°å±é€‚é… */
  @media (max-width:390px){
    :root{ --wheelSize: 320px; }
  }
</style>
</head>

<body>
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
  <canvas id="fx"></canvas>

  <h1>ä¸“å±å¹¸è¿è½¬ç›˜ ğŸ’–</h1>
  <div class="sub">ç‚¹ä¸€ä¸‹å¼€å§‹ï¼Œå°±æŠŠæ‰€æœ‰ç¤¼ç‰©ï¼ˆå’Œä¸€ç‚¹ç‚¹å¿ƒåŠ¨ï¼‰éƒ½ç»™ä½ ã€‚</div>

  <div class="card">
    <!-- å¼€å§‹ç•Œé¢ -->
    <div class="startArea" id="startArea">
      <button class="bigBtn" id="startBtn">å¼€å§‹</button>
      <div class="tip">ï¼ˆç‚¹â€œå¼€å§‹â€ä¼šæ’­æ”¾æš§æ˜§BGM ğŸµï¼‰</div>
    </div>

    <!-- æ¸¸æˆç•Œé¢ -->
    <div class="gameArea" id="gameArea">
      <div class="wrap">
        <div class="pointer" aria-hidden="true"></div>

        <div class="wheelShell">
          <div id="wheel">
            <div id="labels"></div>
          </div>
          <div class="divider"></div>
          <div class="hub"><div class="pulse">LOVE</div></div>
        </div>

        <div class="btnRow">
          <button class="btn" id="spinBtn">å¼€å§‹æŠ½å¥–</button>
          <button class="btn" id="musicBtn">éŸ³ä¹ï¼šå¼€</button>
        </div>

        <div id="result">ç‚¹å‡»ã€Œå¼€å§‹æŠ½å¥–ã€ï½ ä½ çš„å¥½è¿æ­£åœ¨æ’é˜Ÿã€‚</div>
      </div>
    </div>
  </div>

  <!-- æš§æ˜§æµªæ¼« BGMï¼ˆå¯æ¢æˆä½ è‡ªå·±çš„é“¾æ¥ï¼‰ -->
  <audio id="bgm" loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5a6fa2e1f3.mp3?filename=romantic-background-112199.mp3" type="audio/mp3">
  </audio>

  <!-- è¡¨ç™½å¼¹çª— -->
  <div id="popup">
    <div class="popupBox">
      <button class="closeX" id="closeX">Ã—</button>
      <div class="popupInner" id="popupInner">
        <h2>ä½ æ„¿æ„åšæˆ‘çš„å¥³æœ‹å‹å—ï¼ŸğŸ’–</h2>
        <div class="popupHint">æç¤ºï¼šä¸æ„¿æ„ä¼šé€ƒè·‘ï¼ˆå®ƒä¹ŸçŸ¥é“ç­”æ¡ˆğŸ˜ï¼‰</div>

        <div class="chooseArea" id="chooseArea">
          <button class="yesBtn" id="yesBtn">æ„¿æ„ ğŸ’•</button>
          <button class="noBtn" id="noBtn">ä¸æ„¿æ„ ğŸ™ˆ</button>
        </div>

        <div style="margin-top:12px;color:#111827;font-weight:900;font-size:13px;line-height:1.6;">
          ä½ ç‚¹ã€Œæ„¿æ„ã€ï¼Œæˆ‘å°±æŠŠæ‰€æœ‰ç¤¼ç‰©éƒ½ç»™ä½ ï¼ˆè¿åŒæˆ‘è‡ªå·±ï¼‰ã€‚
        </div>
      </div>
    </div>
  </div>

<script>
/* =========================
   0) DOM
========================= */
const startArea = document.getElementById("startArea");
const gameArea  = document.getElementById("gameArea");
const startBtn  = document.getElementById("startBtn");

const wheel     = document.getElementById("wheel");
const labels    = document.getElementById("labels");
const spinBtn   = document.getElementById("spinBtn");
const result    = document.getElementById("result");

const popup     = document.getElementById("popup");
const closeX    = document.getElementById("closeX");
const popupInner= document.getElementById("popupInner");
const chooseArea= document.getElementById("chooseArea");
const yesBtn    = document.getElementById("yesBtn");
const noBtn     = document.getElementById("noBtn");

const bgm       = document.getElementById("bgm");
const musicBtn  = document.getElementById("musicBtn");

/* =========================
   1) è½¬ç›˜é…ç½®
========================= */
const prizes = [
  "æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–","æ²¡ä¸­å¥–",
  "ğŸ“¸ æ‹ç«‹å¾—","ğŸ¶ çº¿æ¡å°ç‹—","ğŸŒ¹ é²œèŠ±","ğŸ’– è·å¾—æ‰€æœ‰ç¤¼å“"
];
const N = prizes.length;     // 10
const STEP = 360 / N;        // 36Â°
const POINTER_AT = -90;      // æŒ‡é’ˆæ–¹å‘ï¼ˆ12ç‚¹ï¼‰
const WIN_INDEX = 9;         // æ°¸è¿œä¸­â€œè·å¾—æ‰€æœ‰ç¤¼å“â€

/* ç”Ÿæˆæ ‡ç­¾ï¼šæ‰‡åŒºä¸­å¿ƒè§’ + æ—‹å›æ­£å‘ */
const r = 128;
prizes.forEach((text,i)=>{
  const centerAngle = POINTER_AT + i*STEP + STEP/2;
  const el = document.createElement("div");
  el.className = "label" + (text.length>=6 ? " small" : "");
  el.textContent = text;
  el.style.color = (text==="æ²¡ä¸­å¥–") ? "#6b7280" : "#111827";
  el.style.transform =
    `rotate(${centerAngle}deg) translate(${r}px, -10px) rotate(${-centerAngle}deg) translate(-50%, 0)`;
  labels.appendChild(el);
});

/* è®¡ç®—è®© index æ‰‡åŒºä¸­å¿ƒå¯¹é½æŒ‡é’ˆçš„æ—‹è½¬è§’ */
function computeRotationToLandOn(index){
  const winCenter = POINTER_AT + index*STEP + STEP/2;
  const baseRotation = POINTER_AT - winCenter; // æ»¡è¶³ center + rot == POINTER_AT
  const spins = 9; // å¤šè½¬å‡ åœˆ
  return spins*360 + baseRotation;
}

/* =========================
   2) éŸ³ä¹
========================= */
let musicOn = true;

async function playMusic(){
  if(!musicOn) return;
  try{ await bgm.play(); }catch(e){}
}
function toggleMusic(){
  musicOn = !musicOn;
  if(musicOn){
    musicBtn.textContent = "éŸ³ä¹ï¼šå¼€";
    playMusic();
  }else{
    musicBtn.textContent = "éŸ³ä¹ï¼šå…³";
    bgm.pause();
  }
}
musicBtn.addEventListener("click", toggleMusic);

/* =========================
   3) å¼€å§‹ï¼šæ˜¾ç¤ºè½¬ç›˜ + æ’­æ”¾BGM
========================= */
startBtn.addEventListener("click", async ()=>{
  startArea.style.display="none";
  gameArea.style.display="block";
  await playMusic();
  heartsBurst(16);
});

/* =========================
   4) æŠ½å¥–ï¼ˆå¿…ä¸­ç‰¹ç­‰å¥–ï¼‰
========================= */
spinBtn.addEventListener("click", async ()=>{
  spinBtn.disabled = true;
  await playMusic();

  result.classList.remove("shake");
  result.innerHTML = "è½¬ç›˜å¯åŠ¨ä¸­â€¦ğŸ’ ä½ çš„å¥½è¿æ­£åœ¨åŠ è½½ä¸­â€¦";

  // è½»å¾®æ‰°åŠ¨ä½†ä»è½åœ¨åŒä¸€æ ¼ï¼ˆå°å¹…åº¦ï¼‰
  const wiggle = (Math.random()*8 - 4);
  const rotation = computeRotationToLandOn(WIN_INDEX) + wiggle;
  wheel.style.transform = `rotate(${rotation}deg)`;

  setTimeout(()=>{
    result.classList.add("shake");
    result.innerHTML = `
      <div class="winTitle">ğŸ‰ æ­å–œä½ è·å¾—ï¼š</div>
      ğŸ“¸ æ‹ç«‹å¾— + ğŸ¶ çº¿æ¡å°ç‹— + ğŸŒ¹ é²œèŠ± + ğŸ’– è·å¾—æ‰€æœ‰ç¤¼å“<br><br>
      <button class="btn" id="claimBtn">ç‚¹å‡»é¢†å–</button>
    `;
    confettiBurst();
    heartsBurst(40);

    document.getElementById("claimBtn").addEventListener("click", ()=>{
      showPopup();
    });

    spinBtn.disabled = false;
  }, 4900);
});

/* =========================
   5) å¼¹çª— + ä¸æ„¿æ„é€ƒè·‘
========================= */
function showPopup(){
  popup.style.display="flex";
  playMusic();
  moveNoBtn(true);
}
function hidePopup(){
  popup.style.display="none";
}
closeX.addEventListener("click", hidePopup);
popup.addEventListener("click", (e)=>{ if(e.target===popup) hidePopup(); });

function rand(min,max){ return min + Math.random()*(max-min); }

function moveNoBtn(isFirst=false){
  const pad = 10;
  const areaW = chooseArea.clientWidth;
  const areaH = chooseArea.clientHeight;

  const btnW = noBtn.offsetWidth || 96;
  const btnH = noBtn.offsetHeight || 42;

  let x, y, tries=0;
  do{
    x = rand(pad, areaW - btnW - pad);
    y = rand(pad, areaH - btnH - pad);
    tries++;
  }while(tries<12 && x < 150 && y > 25 && y < 105); // é¿å¼€â€œæ„¿æ„â€æŒ‰é’®é™„è¿‘

  noBtn.style.left = x + "px";
  noBtn.style.top  = y + "px";
  noBtn.style.transform = isFirst ? "scale(1)" : `scale(${rand(.92,
